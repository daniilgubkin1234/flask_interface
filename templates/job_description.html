<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Должностная инструкция</title>
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='job_description.css') }}"
        />
    </head>

    <body>
        <div class="container">
            <h2>Должностная инструкция</h2>
            <!-- Панель выбора профиля для импорта в ДИ -->
            <div class="profiles-toolbar">
                <div class="toolbar-left">
                    <label for="jdEmployeeSelect">Профиль для ДИ:</label>
                    <select id="jdEmployeeSelect">
                        <option value="">— загрузка списка… —</option>
                    </select>
                    <button type="button" id="jdImportEmpBtn">
                        Импортировать профиль
                    </button>
                </div>
            </div>

            <form id="jobDescriptionForm" action="#" method="POST">
                <!-- 0. Титульный лист -->
                <fieldset>
                    <legend>Титульный лист</legend>
                    <label for="company">Наименование компании:</label>
                    <input type="text" id="company" name="company" required />

                    <label for="position">Наименование должности:</label>
                    <input type="text" id="position" name="position" required />

                    <label for="approval"
                        >Утверждение (год, номер, код инструкции):</label
                    >
                    <input type="text" id="approval" name="approval" required />
                </fieldset>

                <!-- 1. Общие положения -->
                <fieldset>
                    <legend>1. Общие положения</legend>
                    <label for="appointedBy">Кем назначается:</label>
                    <input type="text" id="appointedBy" name="appointedBy" />

                    <label for="documentPurpose"
                        >Каким документом назначается:</label
                    >
                    <input
                        type="text"
                        id="documentPurpose"
                        name="documentPurpose"
                    />

                    <label for="replaces"
                        >Кто заменяет на период отсутствия:</label
                    >
                    <input type="text" id="replaces" name="replaces" />

                    <label for="activityGuide"
                        >Чем руководствуется в своей деятельности:</label
                    >
                    <input
                        type="text"
                        id="activityGuide"
                        name="activityGuide"
                    />

                    <label for="supervisor">Кому подчиняется:</label>
                    <input type="text" id="supervisor" name="supervisor" />
                </fieldset>

                <!-- 2. Требования к кандидатам на вакансию -->
                <fieldset>
                    <legend>2. Требования к кандидатам на вакансию</legend>

                    <label for="name">Имя сотрудника:</label>
                    <input type="text" id="name" name="name" />

                    <label for="gender">Пол:</label>
                    <input type="text" id="gender" name="gender" />

                    <label for="age">Возраст:</label>
                    <input type="number" id="age" name="age" />

                    <label for="residence">Проживание:</label>
                    <input type="text" id="residence" name="residence" />

                    <label for="education">Образование:</label>
                    <input type="text" id="education" name="education" />

                    <label for="speech">Грамотная речь:</label>
                    <input type="text" id="speech" name="speech" />

                    <label for="languages">Знание иностранных языков:</label>
                    <input type="text" id="languages" name="languages" />

                    <label for="pc">Владение ПК, оргтехникой:</label>
                    <input type="text" id="pc" name="pc" />

                    <label for="appearance">Внешний вид:</label>
                    <input type="text" id="appearance" name="appearance" />

                    <label for="habits">Вредные привычки:</label>
                    <input type="text" id="habits" name="habits" />

                    <label for="info">Умение работать с информацией:</label>
                    <input type="text" id="info" name="info" />

                    <label for="accuracy">Точность:</label>
                    <input type="text" id="accuracy" name="accuracy" />

                    <label for="scrupulousness">Скурпулезность:</label>
                    <input
                        type="text"
                        id="scrupulousness"
                        name="scrupulousness"
                    />

                    <label for="systemThinking">Системное мышление:</label>
                    <input
                        type="text"
                        id="systemThinking"
                        name="systemThinking"
                    />

                    <label for="decisiveness">Решительность:</label>
                    <input type="text" id="decisiveness" name="decisiveness" />

                    <label for="stressResistance">Стрессоустойчивость:</label>
                    <input
                        type="text"
                        id="stressResistance"
                        name="stressResistance"
                    />

                    <label for="otherQualities">Иные качества:</label>
                    <input
                        type="text"
                        id="otherQualities"
                        name="otherQualities"
                    />

                    <label for="independence"
                        >Умение самостоятельно принимать решение:</label
                    >
                    <input type="text" id="independence" name="independence" />

                    <label for="organization"
                        >Умение организовать труд подчиненных:</label
                    >
                    <input type="text" id="organization" name="organization" />

                    <label for="responsibility"
                        >Умение брать ответственность:</label
                    >
                    <input
                        type="text"
                        id="responsibility"
                        name="responsibility"
                    />

                    <label for="managementStyle">Стиль управления:</label>
                    <input
                        type="text"
                        id="managementStyle"
                        name="managementStyle"
                    />

                    <label for="leadership">Лидерские качества:</label>
                    <input type="text" id="leadership" name="leadership" />

                    <label for="mobility">Мобильность:</label>
                    <input type="text" id="mobility" name="mobility" />

                    <label for="businessTrips"
                        >Возможность и желание командировок:</label
                    >
                    <input
                        type="text"
                        id="businessTrips"
                        name="businessTrips"
                    />

                    <label for="car">Наличие автомобиля:</label>
                    <input type="text" id="car" name="car" />

                    <!-- Дополнительные пункты из портрета -->
                    <div id="profileAdditionalFields"></div>
                </fieldset>

                <!-- 3. Основные направления деятельности -->
                <fieldset>
                    <legend>3. Основные направления деятельности</legend>
                    <div id="mainActivities">
                        <input
                            type="text"
                            name="mainActivity[]"
                            placeholder="Введите направление деятельности"
                        />
                    </div>
                    <button type="button" id="addActivity">
                        + Добавить направление
                    </button>
                </fieldset>

                <!-- 4. Должностные обязанности -->
                <fieldset>
                    <legend>4. Должностные обязанности</legend>
                    <div id="jobDuties">
                        <input
                            type="text"
                            name="jobDuty[]"
                            placeholder="Введите должностную обязанность"
                        />
                    </div>
                    <button type="button" id="addDuty">
                        + Добавить обязанность
                    </button>
                </fieldset>

                <!-- 5. Права -->
                <fieldset>
                    <legend>5. Права</legend>
                    <textarea name="rights" rows="3"></textarea>
                </fieldset>

                <!-- 6. Ответственность -->
                <fieldset>
                    <legend>6. Ответственность</legend>
                    <textarea name="responsibility" rows="3"></textarea>
                </fieldset>

                <!-- 7. Адаптационный план -->
                <fieldset id="adaptationPlanJD">
                    <legend>7. Адаптационный план</legend>

                    <div id="jdTasksContainer">
                        <!-- Шаблонный первый fieldset (идентичный adaptation_plan.html) -->
                        <fieldset class="task">
                            <legend>Задача 1: Оформление на работу</legend>
                            <label for="task1_time">Время на подготовку:</label>
                            <input
                                type="text"
                                id="task1_time"
                                name="task1_time"
                                placeholder="Введите время на подготовку"
                                required
                            />

                            <label for="task1_resources">Ресурсы:</label>
                            <textarea
                                id="task1_resources"
                                name="task1_resources"
                                rows="2"
                                placeholder="Введите ресурсы"
                                required
                            ></textarea>

                            <label for="task1_summarize_by_mentor"
                                >Подведение итогов наставником:</label
                            >
                            <textarea
                                id="task1_summarize_by_mentor"
                                name="task1_summarize_by_mentor"
                                rows="2"
                                placeholder="Введите подведение итогов наставником"
                            ></textarea>

                            <label for="task1_summarize_by_employee"
                                >Подведение итогов сотрудником:</label
                            >
                            <textarea
                                id="task1_summarize_by_employee"
                                name="task1_summarize_by_employee"
                                rows="2"
                                placeholder="Введите подведение итогов сотрудником"
                            ></textarea>

                            <button type="button" class="delete-task-btn">
                                Удалить задачу
                            </button>
                        </fieldset>

                        <!-- Кнопки добавления (как на странице адаптационного плана) -->
                        <div class="add-task-wrapper">
                            <button
                                type="button"
                                class="add-task-btn"
                                id="jdAddTask"
                            >
                                + Добавить задачу
                            </button>
                        </div>
                    </div>
                </fieldset>

                <button type="submit">Сохранить</button>
                
                <script>
                    document
                        .getElementById("syncPersonnelBtn")
                        .addEventListener("click", () => {
                            fetch("/sync_personnel_from_sources", {
                                method: "POST",
                            })
                                .then((r) => r.json())
                                .then(() => {
                                    // после синхронизации просто перезагрузим форму ДИ
                                    location.reload();
                                })
                                .catch((err) =>
                                    alert("Ошибка синхронизации: " + err)
                                );
                        });
                </script>
            </form>
        </div>
        <button class="toggle-sidebar">☰</button>
        <!-- Навигационный блок -->
        <div class="recommendation-block">
            <h3>📌 Рекомендуем осуществить работу с другими блоками:</h3>
            <div class="recommendation-section">
                <h4>Диагностика</h4>
                <div class="button-row">
                    <button onclick="window.location.href='/survey_ai'">
                        Перейти к диагностике
                    </button>
                </div>
            </div>

            <div class="recommendation-section">
                <h4>Задачи</h4>
                <div class="button-row">
                    <button onclick="window.location.href='/business'">
                        Бизнес цель
                    </button>
                    <button onclick="window.location.href='/tasks'">
                        Задачи, план мероприятий и работ
                    </button>
                    <button onclick="window.location.href='/meeting_protocol'">
                        Протокол совещания
                    </button>
                </div>
            </div>

            <div class="recommendation-section">
                <h4>Персонал</h4>
                <div class="button-row">
                    <button onclick="window.location.href='/employee_profile'">
                        Портрет сотрудника
                    </button>
                    <button onclick="window.location.href='/three_plus_twenty'">
                        Должностные обязанности
                    </button>
                    <button onclick="window.location.href='/adaptation_plan'">
                        Адаптационный план
                    </button>
                    <button onclick="window.location.href='/job_description'">
                        Должностная инструкция
                    </button>
                </div>
            </div>

            <div class="recommendation-section">
                <h4>Система стимулирования</h4>
                <div class="button-row">
                    <button
                        onclick="window.location.href='/stimulation_system'"
                    >
                        Система стимулирования
                    </button>
                </div>
            </div>

            <div class="recommendation-section">
                <h4>Бизнес-процессы</h4>
                <div class="button-row">
                    <button
                        onclick="window.location.href='/business_processes'"
                    >
                        Бизнес-процессы
                    </button>
                    <button onclick="window.location.href='/regulations_list'">
                        Реестр корпоративных стандартов
                    </button>
                </div>
            </div>

            <div class="recommendation-section">
                <h4>Организационная структура</h4>
                <div class="button-row">
                    <button
                        onclick="window.location.href='/organizational_structure'"
                    >
                        Организационная структура
                    </button>
                </div>
            </div>

            <div class="recommendation-section">
                <h4>Дополнительно</h4>
                <div class="button-row">
                    <button onclick="window.location.href='/question_answer'">
                        Спроси АСТРу
                    </button>
                </div>
            </div>
        </div>

        <script
            defer
            src="{{ url_for('static', filename='job_description.js') }}"
        ></script>
    </body>
</html>
